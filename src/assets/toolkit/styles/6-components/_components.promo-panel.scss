/** In-page block with promotion */

$banner-background: $grey-gallery;
$promo-max-width:   60em;


.promo-panel {
  @include clearfix();

  &.pattern {
    background: url( 'http://www.victoria.ac.nz/__data/assets/image/0005/216698/maori-bg-pattern.png' ); //TODO: Autolink from CDN!

    figure {
      background: transparent;
      box-shadow: none;
    }
  }

  &.no-pattern {
    background: $banner-background;

    figure {
      background: transparent;
      box-shadow: 0;
    }
  }

  &.white-bg {
    background-color: $white;

    figure {
      border: 1px solid $grey-gallery;

      @include media( $mobile-large-and-smaller ) {
        border: 0;
      }
    }

    &.dual-content {
      .dual-content-block {
        border: 1px solid $grey-gallery;

        > * { border: 0; }
      }
    }
  }

  figure {
    overflow: hidden; //TODO: Change to something safer
    position: relative;
    padding: 0;
    background: $white;

    figcaption {
      padding-bottom: $base-spacing;
    }

    &.photo {
      figcaption {
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p {
          display: inline-block;
          margin-bottom: .5em;
          padding: .5rem 1rem;
          color: $white;
          background-color: rgba( 102, 167, 93, .9 );
        }
      }

      // Research hub new panel, promo panel with left align grey text panel
      &.left-text-panel {
        figcaption {
          max-width: 88em;

          > div {
            position: relative;
            margin: 3em 1.11em;
            padding: 2em;
            max-width: 55%;
            background-color: rgba( $white, .9 );
            box-shadow: 0 3px 7px 1px rgba( #000, .21 );
            text-align: left;

            // TODO: Refactor & flatten to lower the depth!
            h1,
            h2,
            h3,
            p {
              text-align: left;
            }

            h1,
            h2,
            h3 {
              position: absolute;
              top: -1.8rem;
              padding: .8rem 1rem;
              background-color: $green-victoria;
            }

            p {
              padding-top: 2em;
              padding-left: 0;
              background-color: transparent;
              color: inherit;
            }

            p,
            .button {
              margin-left: 1rem;
            }
          }

          // TODO: Refactor & flatten to lower the depth!
          @include media( $mobile-large-and-smaller ) {
            > div {
              max-width: 100%;

              p { padding-top: 3.5em; }
              .button:not(:first-child) { margin-top: .5rem; }
            }
          }

          @include media( $tablet ) {
            > div { max-width: 85%; }
          }

        }
      }

    }

    @include media( $tablet-and-bigger) {
      display: flex;
      align-items: center;
      box-shadow: $base-shadow;

      figcaption {
        @include span-columns( 7 of 12, block-collapse );
        z-index: $z-index-lower;
        padding: $base-spacing * 1.5;

        p {
          margin-bottom: 1.3em;
          font-size: 1.2em;
        }
      }

      img {
        @include span-columns( 5 of 12, block-collapse );
      }

      &.two-thirds {
        @include span-columns( 8 of 12 );
        @include shift( 2 );

        figcaption {
          @include span-columns( 4 of 8 );
          @include shift( 4 );
          position: relative;
          padding: $base-spacing;
          background: $white;
        }

        img {
          @include size( auto 100% );
          position: absolute;
          top: 0;
          left: 0;
        }
      }

      &.photo,
      &.pattern,
      &.no-pattern {
        figcaption {
          z-index: $z-index-lower;
          position: relative;
          float: none;
          margin: 0 auto;
          padding: $base-spacing * 1.5 0;
          width: auto;
          max-width: $promo-max-width;
          text-align: center;
        }

        img {
          @include position( absolute, 0 0 null 0 );
          width: 100%;
        }
      }
    }

  }

  &.study-hub {
    background-color: $white;

    figure {
      padding: $base-spacing 0;
      color: $grey;
      box-shadow: none;

      p { color: $grey; }

      figcaption {
        padding: $base-spacing $base-spacing * 1.5;

        &:first-child {
          @include span-columns( 7 of 12, block-collapse );

          h1 { color: $green-light-victoria; }
        }
      }

      // TODO: Refactor & flatten to lower the depth!
      > *:last-child {
        @include span-columns( 5 of 12, block-collapse );
        padding: $base-spacing $base-spacing * 1.5;
        border-left: 2px solid $grey-alto;

        > h3 { color: $grey; }

        > ul {
          padding-left: 0;

          li {
            padding-left: 0;
            list-style: none;

            span {
              color: $green-light-victoria;
              font-weight: $weight-bold;
            }
          }
        }

      }
    }
  }

  // Half panels with green title and image above content
  &.two-panels {
    > div { display: flex; }

    figure {
      display: block;
      flex: 0 1 50%;

      img {
        width: 100%;

        + figcaption {
          margin-top: -25%;
          padding-top: 0;
          background-color: $white;

          h1,
          h2 {
            margin-top: -1em;
          }
        }
      }

      figcaption {
        width: 100%;

        h1,
        h2 {
          display: inline-block;
          margin-left: -.5em;
          padding: .4em .5em;
          color: $white;
          background-color: $green-victoria;
        }
      }

      &:first-child { margin-right: 1em; }
    }

    @include media( $mobile-large-and-smaller ) {
      > div { flex-wrap: wrap; }

      figure {
        flex: 0 1 100%;

        img {
          width: 100%;

          + figcaption {
            margin-top: 0;
            padding-left: 1em;
          }
        }

        &:first-child { margin-right: 0; }
      }
    }

  }

  &.dual-content {
    .dual-content-block {
      @include clearfix();
      background-color: $white;

      figure {
        &:first-child {
          @include span-columns( 7 of 12, block-collapse );
          padding: $base-spacing * 1.5;
          box-shadow: none;

          figcaption {
            padding: 0;
            width: 100%;
          }

          @include media( $mobile-large-and-smaller ) {
            @include span-columns( 12 of 12, block-collapse );
            padding: 0 0 $base-spacing 0;
          }
        }

        &:last-child {
          @include span-columns( 5 of 12, block-collapse );

          img { width: 100%; }

          // TODO: Refactor & flatten to lower the depth!
          figcaption {
            .play-button {
              position: absolute;
              right: 1rem;
              bottom: 1rem;
            }
          }

          @include media( $mobile-large-and-smaller ) {
            @include span-columns( 12 of 12, block-collapse );

            // TODO: Refactor & flatten to lower the depth!
            figcaption { margin-bottom: 0; }
          }
        }
      }

    }
  }

  &.two-one-third {
    > div {
      display: flex;

      &.half-panel {
        > *:first-child {
          display: flex;
          align-items: center;
          justify-content: space-around;
          margin-right: 0;
          width: 100 / 3 * 2%;

          > *:first-child { width: 50%; }

          @include media( $tablet-and-smaller ) {
            flex-direction: column;

            // TODO: Refactor & flatten to lower the depth!
            figcaption:first-child { width: 100%; }
          }
        }

        > *:last-child { width: 100 / 3 * 1%; }

        @include media( $mobile-large-and-smaller ) {
          > *:first-child,
          > *:last-child {
            width: 100%;
          }
        }
      }

      @include media( $mobile-large-and-smaller ) {
        flex-direction: column;

        >:first-child,
        >:last-child { width: 100%; }
      }
    }

    figure {
      figcaption { padding: 1.4em; }

      &:first-child {
        margin-right: $block-padding;
        width: 100 / 3 * 2%;

        img {
          height: 100%;
          object-fit: cover;
        }
      }

      &:last-child {
        width: 100 / 3 * 1%;

        figcaption {
          width: 100%;
          text-align: right;
        }
      }
    }
  }

  // image with offset title and text on right
  &.title-image {
    background-color: $white;

    > div {
      display: flex;
      align-items: center;
    }

    figure {
      @include span-columns( 5 of 12, block-collapse );
      flex: 1 0 auto;
      padding: 1em;
      box-shadow: none;

      img { width: 100%; }

      figcaption {
        position: absolute;
        top: 2em;
        left: 0;
        padding: 1em;
        width: 80%;
        background-color: $green-victoria;

        h1,
        h2,
        h3 {
          margin-bottom: 0;
          color: $white;
        }

      }
    }

    section { padding: 1em 1em 1em 2em; }

    @include media( $tablet ) {
      > div { align-items: stretch; }

      figure {
        img {
          position: relative;
          top: 35%;
        }

        figcaption { top: 0; }
      }
    }

    @include media( $mobile-large-and-smaller ) {
      > div {
        flex-direction: column;

        figure { width: 100%; }
      }
    }
  }

  @include media( $tablet-and-bigger ) {
    overflow: hidden;
    position: relative;
    background: $banner-background;
  }

  @include media( $mobile-large-and-smaller ) {
    border-top: 3px solid $banner-background;
    border-bottom: 3px solid $banner-background;

    + .promo-panel { border-top: 0; }
  }

}

.promo {
  @include clearfix();
}

.text-promo-panel {
  padding: 1.5em 0;
  border-bottom: $base-border;

  .text-wrap {
    @include media( $tablet-and-bigger ) {
      @include span-columns( 6 of 8 );
    }
  }

  .button-wrap {
    margin-top: 2.5em;

    @include media( $tablet-and-bigger ) {
      @include span-columns( 2 of 8 );
    }
  }

  // TODO: Move into its standalone .promo-video class
  &.video {

    // Figure
    .media .outside {
      position: relative;
      top: auto;
      left: auto;
      margin-bottom: 0;
      width: 100%;
      max-width: 100%;
    }

    .outside {
      h4 {
        margin-bottom: 0;
        padding: .65em .5em;

        i { margin-left: .5em; }
      }
    }

  }
}

